<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>图片延迟加载/图片懒加载</title>
    <style>
        .banner {
            width: 330px;
            height: 220px;
            background: url('img/default.gif') no-repeat center center #e1e1e1;
        }
        
        .banner img {
            /*在开始时img的src属性没有地址，在IE浏览器中显示默认碎图，将其取消*/
            display: none;
            width: 100%;
            height: 100%;
        }
    </style>
    <script src="./utils.js"></script>
</head>

<body>
    <!--
    作用：保证页面打开速度（3s内首页打不开算死亡页面）
    原理：
    1）对于首屏内容中的图片：首先给对应的区域一张默认图片（<5kb）
    首屏内容加载完成后，再加载图片
    2）对于其他屏中的图片，给一张默认的图片占位，当滚动条滚动到对应区域时，再进行加载
    扩展：数据异步加载
    网站性能优化：
    尽量减少向服务器的请求次数, 减少HTTP请求：
        css/js文件合并
        icon图片雪碧图（css sprite）合并
        图片延迟加载
        数据异步加载
        移动端：尽量将css和js写成内嵌式
-->
    <div class="banner">
        <img src="" alt="" trueImg="/images/5.jpg">
    </div>
    <script>
        // 56第一屏图片延时加载
        var banner = document.getElementById("banner"),
            imgFir = banner.getElementsByTagName("img")[0];
        // 图片延迟加载两种方式：window.onload, window.setTimeout()
        // window.onload
        window.setTimeout(function() {
            // var oImg = document.cteateElement("img");
            // 验证加载成功
            var oImg = new Image;
            oImg.src = imgFir.getAttribute("trueImg");
            oImg.onload = function() {
                    imgFir.src = this.src;
                    imgFir.style.display = "block";
                    oImg = null;
                    imgFir.isLoad = true;
                    // console.log("图片加载完成");
                    // var newTime = new Date;
                    // console.log(newTime - time);
                }
                // console.log("图片正在加载中...");
                // var time = new Date;
        }, 500);
        // 57其他平图片延时加载
        var banner = docuemnt.getElementById("banner"),
            imgFir = banner.getElementByTagName("img")[0];
        window.scroll = funtion() {
            var A = banner.offsetHeight + utils.offset(banner).top;
            var B = utils.win("clientHeight") + utils.win("scrollTop");
            if (A < B) {
                var oImg = new Image;
                oImg.src = imgFir.getAttribute("trueImg");
                oImg.onload = function() {
                        imgFir.src = this.src;
                        imgFir.style.display = "block";
                        oImg = null;
                    }
                    // 避免浏览器重新再banner滚动条滚动时重复加载，不管是否正常加载
                banner.isLoad = true;
            }
        }
    </script>
</body>

</html>